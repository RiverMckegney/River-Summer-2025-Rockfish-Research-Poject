---
title: "SU_25_River_Rockfish_Proj_Fecundity_Ambient_V0.2"
author: "River Mckegney"
date: "`r Sys.Date()`"
output: html_document
---



## Setup, and Packages

```{r setup, include=FALSE}
# Setup
knitr::opts_chunk$set(echo = TRUE)
```

Code Packages:
```{r packages}
# Load packages
library(gridExtra) # For using grid.table to save tables as images
library(flextable) # Alternative method to save df as image
library(tidyverse)
library(zoo)
library(lme4)
library(lmerTest)
library(rlang)
library(nortest) # For ad.test
library(car) # For homogeneity of variance with leveneTest
library(rcompanion) # For scheirerRayHare test
library(pastecs) # For stat.desc
library(ggpubr) # For assumption plots
library(conover.test) # For the conover.Iman() test function
library(DescTools) # Contain alternative ConoverTest function
library(rstatix) # tidyverse adapted stat tests and mshapiro_test() functions
library(DHARMa) # For multi-level lm models and shapiro test
library(patchwork) # For combining ggplots
```



## Data Entry: Read-in data

```{r}
# Read and call data into df

# Primary samples df
ABL90 <- read.csv("Raw_Data/ABL90_Raw.csv")

# River's Parturition metadata
partuition_subcat <- read.csv("Raw_Data/River's_Rockfish_Metadata_Parturition_V7.csv")

```


## Data Filtering

```{r}
# Data sifting: ABL90 dataset

# Step 1: Remove missing info
ABL_set1 <- ABL90 %>%
  filter(Patient.ID_edited != "") 
  

# Step 2: Separate Patient.ID into columns of sample types: blood plasma and instant freeze plasma 
ABL_set2 <- separate(ABL_set1, 'Patient.ID_edited', into = c("Patient.ID_edited", "Sample_Type"), sep = ",")  


# Step 3:
# Convert Patient.ID_edited column data to character type
ABL_set2$Patient.ID_edited <- as.character(ABL_set2$Patient.ID_edited) 

```


```{r}
# Step 4 & 5: Sussing out specific sample errors  

# Remove insufficient samples
ABL_set3 <- ABL_set2 %>%
  filter(!is.na("Type")) %>%
  filter(!str_detect(Errors.detected.during.measurement, "Insufficient sample"))

# Remove inhomogeneous samples
ABL_set3 <- ABL_set3 %>%
  filter(!is.na("Type")) %>%
  filter(!str_detect(Errors.detected.during.measurement, "Inhomogeneous sample"))

# Step 6: Filter for only blood samples
ABL_b_samp <- ABL_set3 %>%
  filter(Sample_Type == "b")

```


## Merge Datasets:

Join ABL90 df with parturition_subcat df: Making ABL_merged
```{r}
# Rename columns to match: Change 'ID' in parturition_subcat to 'Patient.ID_edited' so it is ready to join with ABL90 df

# Please note the 'Treatment' col in parturition_subcat does not match with the finalized 'Ambient.Or.OAH' col in metadata_atresia_guide or ABL90_merged df

# Rename 'ID' col to 'patient.ID_edited'
partuition_subcat <- partuition_subcat %>%
  rename(Patient.ID_edited = ID)

```

```{r}
# Connect main ABL90 dataset with my (River's) sub categorized parturition metadata 
# ABL_merged <- partuition_subcat %>%
# left_join(ABL_b_samp, by = "Patient.ID_edited")

ABL_merged <- ABL_b_samp %>%
inner_join(partuition_subcat, by = "Patient.ID_edited")
```

Rename Columns Neatly:
```{r}
# Rename Treatment & Parturition Outcome
ABL_merged <- ABL_merged %>%
  rename(Ambient.Or.OAH = Consensus_General_Treatment,
         Pregnant.Or.Atresia = Consensus_Atresia_Or_Pregnant)
         
```


## Remove Samples: Mortalities, NA's, or Missing Info, and Replicates

Remove Replicate ID's
```{r}
# Cross Check all Columns: Cross validation to suss correct replicate row
check_params <- ABL_merged %>%
  select(Patient.ID_edited, Time, Sample.., Measuring.Mode, Ambient.Or.OAH, Pregnant.Or.Atresia, pH, Glu..mmol.L., Hct...., Na...mmol.L., Cl...mmol.L., K...mmol.L., Ca....mmol.L., pCO2..mmHg.) %>%
  filter(Patient.ID_edited == "9782D")
print(check_params)

check_params <- ABL_merged %>%
  select(Patient.ID_edited, Time, Sample.., Measuring.Mode, Ambient.Or.OAH, Pregnant.Or.Atresia, pH, Glu..mmol.L., Hct...., Na...mmol.L., Cl...mmol.L., K...mmol.L., Ca....mmol.L., pCO2..mmHg.) %>%
  filter(Patient.ID_edited == "9783D")
print(check_params)

# Removed replicates: 9782D (2x) and 9783D (2x)
ABL_merged <- ABL_merged %>%
  filter(Sample.. != "863",
         Sample.. != "934")

```

Review Replicates: 

| Row | ID | Time | Sample.. | Measuring.Mode | pH | Glu.mmol.L. | Hct.... | Na...mmol.L. | Cl...mmol.L. | K...mmol.L. | Ca.mmol.L. |
|:------:| :-----: | :-----: | :-----:| :------:|:------:|:------:|:------:|:------:|:------:|:------:|:------:|
| 32 | 9782D | 12/28/2023 10:04 | 1016 | C 65uL | 7.348 | 0.5 | 9.8 | 184 | 149 | 2.8 | 1.32 |
| 39 | 9782D | 1/9/2024 17:21 | 863 | S 65uL | 7.446 | 0.7 | 13.3 | 181 | 161 | 2.9 | 1.31 |  
| 36 | 9783D | 1/19/2024 10:37 | 934 | S 65uL | 7.484 | 1.7 | **0.2** | 175 | 193 | **34.5** | 1.29 |
| 41 | 9783D | 1/7/2024 12:32 | 860 | S 65uL | 7.450 | 1.3 | **14.7** | 179 | 164 | **2.5** | 1.30 |

Methods for replicate sample removal:
Check processing date of IDs, and remove samples that do not match that date.

Case ID_9782D:

- Origianl ABL90 set contains:
- 9782D,b (Sample.. 1016, Time = 12/28/2023  10:04:00 AM) 
- 9782D,p (Sample.. 1020, Time = 12/28/2023  10:25:00 AM)
- 9782D,p (Sample.. 865, Time = 1/9/2024  5:29:00 PM)
- 9782D,b (Sample.. 863, Time = 1/9/2024  5:21:00 PM)

- 2024_Fish_Metadata.csv says ID_9782D was processed 3/29/2024


- Note Processing date in metadata will not match time date stamp in ABL90 data due to the machine being reset, and innacurrate dates being automatically recorded.

Deciding info:
- For ID-9782D, refer to metadata sheet and look for other samples with that same processing date, then view thoes samples ABL90 'Time'. Try to find a matching 'Time' with other IDs and 9782D that were processed together during the same time recorded by the machine. 

- ID_97838,b (single obs, Sample.. 1024) Time = 12/28/2023  11:49:00 AM

- Since 9782D,b Sample.. 1016 and 97838,b Sample.. 1024 both have a date timestamp occurrence on 12/28/2023, I have decided to keep 9782D,b Sample.. 1016 and drop 9783D,b Sample.. 863


Case ID_9783D

- Original ABL90 dataset contains:
- 9783D,b (Sample.. 934, Time = 1/19/2024  10:37:00 AM)
- 9783D,c (Sample.. 861, Time = 1/7/2024  12:38:00 PM)
- 9783D,b (Sample.. 860, Time = 1/7/2024  12:32:00 PM)

- 2024_Fish_Metadata.csv says ID_9783D was processed 3/20/2024

- Informed that ID_9783D: Sample.. 934 is a plasma sample (on account of its low hct value), remove this and **keep Sample.. 860 (parameter values appear correct)**.


# Samples: Data subsets

Remove Motalities and No info IDs and assign analysis ready data-frames:
```{r}

# New df with Moralities removed: Note none of these samples made it into ABL90 df anyway, so looks like they are already filtered out.
 Live_Samples <- ABL_merged %>%
  filter(Patient.ID_edited != "9780C", # Mortality
         Patient.ID_edited != "777AE", # Mortality
         Patient.ID_edited != "777CA") # Mortality after parturition


# New df with mortality and 'No info' Id's removed
 Primary_Samples <- Live_Samples %>%
   filter(Patient.ID_edited != "777A0", # No info
           Patient.ID_edited != "9782F", # No info
           Patient.ID_edited != "777B3", # No info
           Patient.ID_edited != "777AA", # No info
           Patient.ID_edited != "777DE", # No info
           Patient.ID_edited != "777CE", # No info
           Patient.ID_edited != "777A6") # No info
 
 
# New df of Only Ambient Treatment: For testing parturition success
 Ambient_Samples <- Primary_Samples %>%
   filter(Ambient.Or.OAH == "Ambient")
 
# New df of Fecundity Samples:
 Fecundity_Samples <- Primary_Samples %>%
   filter(Fecundity_Or_Brood_Count != "NA",
     Fecundity_Class != "NA") # removes 97706

# Fecundity samples without atresia Ids
 Fecundity_No_Atresia_Samples <- Primary_Samples %>%
   filter(All_Fecundity != "Na",
          All_Fecundity != 0)  # removes atresia IDs

# Fecundity Ambient Samples
 Amb_Fec_Samples <- Primary_Samples %>%
   filter(Ambient.Or.OAH == "Ambient",
          All_Fecundity != "NA") # removes OAH treatment samples and ID 97706
 
# Fecundity Ambient Samples without atresia Ids
 Amb_Fec_No_Atresia_Samples <- Primary_Samples %>%
   filter(Ambient.Or.OAH == "Ambient", # removes OAH treatment 
          All_Fecundity != "NA", # removes all missing info IDs
          All_Fecundity != 0) # removes atresia IDs
 
```


Change Data Types:
```{r}
# Change Continuous Data to type to numeric, double, or factor

# Change data type of ions to factor or numeric
#glimpse(General_Samples)
#glimpse(Ambient_Samples)
 
Primary_Samples <- Primary_Samples %>%
  mutate(across(c(pH, Hct...., Glu..mmol.L., Na...mmol.L., Cl...mmol.L., K...mmol.L., Ca....mmol.L.), as.numeric))

Ambient_Samples <- Ambient_Samples %>%
  mutate(across(c(pH, Hct...., Glu..mmol.L., Na...mmol.L., Cl...mmol.L., K...mmol.L., Ca....mmol.L.), as.numeric))

Fecundity_Samples <- Fecundity_Samples %>%
  mutate(across(c(All_Fecundity, pH, Hct...., Glu..mmol.L., Na...mmol.L., Cl...mmol.L., K...mmol.L., Ca....mmol.L.), as.numeric))

Fecundity_No_Atresia_Samples <- Fecundity_Samples %>%
  mutate(across(c(All_Fecundity, pH, Hct...., Glu..mmol.L., Na...mmol.L., Cl...mmol.L., K...mmol.L., Ca....mmol.L.), as.numeric))

Amb_Fec_Samples <- Amb_Fec_Samples %>%
  mutate(across(c(All_Fecundity, pH, Hct...., Glu..mmol.L., Na...mmol.L., Cl...mmol.L., K...mmol.L., Ca....mmol.L.), as.numeric))
  
Amb_Fec_No_Atresia_Samples <- Amb_Fec_No_Atresia_Samples %>%
  mutate(across(c(All_Fecundity, pH, Hct...., Glu..mmol.L., Na...mmol.L., Cl...mmol.L., K...mmol.L., Ca....mmol.L.), as.numeric))

# glimpse(Primary_Samples)
# glimpse(Ambient_Samples)
# glimpse(Fecundity_Samples)
# glimpse(Fecundity_Count_Samples)
# glimpse(Amb_Fec_Samples)
```



## Order Factor Levels
```{r}
# Fecundity data 

#unique(Fecundity_Samples$Fecundity_Class)

# Arrange the order of parturition categories for visualizations & tests
Fecundity_Samples$Fecundity_Class <- ordered(Fecundity_Samples$Fecundity_Class, levels = c("High (>50,000)", "Low (~1,000s)", "Atresia"))

Fecundity_No_Atresia_Samples$Fecundity_Class <- 
  ordered(Fecundity_No_Atresia_Samples$Fecundity_Class, levels = c("High (>50,000)", "Low (~1,000s)", "Atresia"))

Amb_Fec_Samples$Fecundity_Class <- ordered(Amb_Fec_Samples$Fecundity_Class, levels = c("High (>50,000)", "Low (~1,000s)", "Atresia"))

Amb_Fec_No_Atresia_Samples$Fecundity_Class <- ordered(Amb_Fec_No_Atresia_Samples$Fecundity_Class, levels = c("High (>50,000)", "Low (~1,000s)", "Atresia"))

```




# Save filtered dataset into data-worked folder
```{r}
# Save merged dataset in a worked folder

write.csv(x = Primary_Samples, file = "Worked-Data/Primary_Samples")

write.csv(x = Ambient_Samples, file = "Worked-Data/Ambient_Samples")

write.csv(x = Fecundity_Samples, file = "Worked-Data/Fecundity_Samples")

write.csv(x = Fecundity_No_Atresia_Samples, file = "Worked-Data/Fecundity_No_Atresia_Samples")

write.csv(x = Amb_Fec_Samples, file = "Worked-Data/Amb-Fec_Samples")

write.csv(x = Amb_Fec_No_Atresia_Samples, file = "Worked-Data/Amb_Fec_No_Atresia_Samples")
```


## Sample Size: n
```{r}
# Sample Size

# Ambient Fecundity data: 
amb_fec_sample_size_table <- Amb_Fec_Samples %>%
  group_by(Ambient.Or.OAH, Fecundity_Class) %>%
  summarise(n_size = n_distinct(Patient.ID_edited), .groups = "drop")
print(amb_fec_sample_size_table)

 pdf("data-images/amb_fec_sample_size_table.pdf")
 grid.table(amb_fec_sample_size_table)
 dev.off()
 
 png("data-images/amb_fec_sample_size_table.png")
 grid.table(amb_fec_sample_size_table)
 dev.off()
 
# Ambient Fecundity No Atresia data:
 
amb_fec_no_atresia_sample_size_table <- Amb_Fec_No_Atresia_Samples %>%
  group_by(Ambient.Or.OAH, Fecundity_Class) %>%
  summarise(n_size = n_distinct(Patient.ID_edited), .groups = "drop")
print(amb_fec_no_atresia_sample_size_table)

 pdf("data-images/amb_fec_no_atresia_sample_size_table.pdf")
 grid.table(amb_fec_no_atresia_sample_size_table)
 dev.off()
 
 png("data-images/amb_fec_no_atresia_sample_size_table.png")
 grid.table(amb_fec_no_atresia_sample_size_table)
 dev.off()

```


Sample Size Barplot:
```{r}
# View Sample Distributions

# Sample Size barplot

# Ambient Fecundity data
amb_fec_sample_size_barplot <- Amb_Fec_Samples %>%
  group_by(Ambient.Or.OAH, Fecundity_Class) %>% 
  summarise(n_size = n_distinct(Patient.ID_edited), .groups = "drop") %>%
  ggplot(aes(x = Fecundity_Class, y = n_size)) +
  geom_bar(stat = "identity") +
  facet_grid(~ Ambient.Or.OAH) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 15.5), breaks = c(0, 3, 6, 9, 12, 15)) +
  labs(title = "Fecundity Sample Size",
        x = "Fecundity Class",
        y = "Sample Size (n)") +
  theme_classic() +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        title = element_text(size = 12),
        plot.title = element_text(size = 30, hjust = 0.5),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(amb_fec_sample_size_barplot)

ggsave(filename = "data-images/.png", plot = amb_fec_sample_size_barplot, device = "png")
ggsave(filename = "data-images/amb_fec_sample_size_barplot.pdf", plot = amb_fec_sample_size_barplot, device = "pdf")


# Ambient Fecundity No Atresia data
amb_fec_no_atresia_sample_size_barplot <- Amb_Fec_No_Atresia_Samples %>%
  group_by(Ambient.Or.OAH, Fecundity_Class) %>% 
  summarise(n_size = n_distinct(Patient.ID_edited), .groups = "drop") %>%
  ggplot(aes(x = Fecundity_Class, y = n_size)) +
  geom_bar(stat = "identity") +
  facet_grid(~ Ambient.Or.OAH) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 15.5), breaks = c(0, 3, 6, 9, 12, 15)) +
  labs(title = "Fecundity Sample Size",
        x = "Fecundity Class",
        y = "Sample Size (n)") +
  theme_classic() +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        title = element_text(size = 12),
        plot.title = element_text(size = 30, hjust = 0.5),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(amb_fec_no_atresia_sample_size_barplot)

ggsave(filename = "data-images/amb_fec_no_atresia_sample_size_barplot.png", plot = amb_fec_no_atresia_sample_size_barplot, device = "png")
ggsave(filename = "data-images/amb_fec_no_atresia_sample_size_barplot.pdf", plot = amb_fec_no_atresia_sample_size_barplot, device = "pdf")

```

Note: Amb Fec No Atreisa Sample subset is a low n-size, but balanced.


# pH

pH Summary Stats
```{r}
# pH
# Summary stats

# Amb Fec data (with atresia IDs)
Amb_Fec_Samples %>%
  group_by(Ambient.Or.OAH, Fecundity_Class) %>%
  summarize(count = n(),
            median = round(median(pH), 3),
            mean = round(mean(pH), 3),
            sd = round(sd(pH), 3),
            cv = round(sd(pH)/mean(pH), 3)) %>%
  ungroup()

# Amb Fec No Atresia data
Amb_Fec_No_Atresia_Samples %>%
  group_by(Ambient.Or.OAH, Fecundity_Class) %>%
  summarize(count = n(),
            median = round(median(pH), 3),
            mean = round(mean(pH), 3),
            sd = round(sd(pH), 3),
            cv = round(sd(pH)/mean(pH), 3)) %>%
  ungroup()

```



Data Graphs:

```{r}
# pH
# Weight adjusted scatterplot 

# Amb Fec only scatterplot: atresia ids removed
pH_amb_fec_no_atresia_weight_adj_scatterplot <- ggplot(data = Amb_Fec_No_Atresia_Samples) + 
  geom_point(aes(x = pH, y = Weight_Adjusted_Fecundity_Fecundity.Mean_Weight), colour = "black") +
  labs(title = "pH", x = "pH", y = "Weight Adjusted Fecundity") +
  scale_y_continuous() + 
  theme_classic() +
  facet_wrap(~ Ambient.Or.OAH) +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        plot.title = element_text(size = 25, hjust = 0.5),
        axis.text.x = element_text(size = 20),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(pH_amb_fec_no_atresia_weight_adj_scatterplot)

ggsave(filename = "data-images/pH_amb_fec_no_atresia_weight_adj_scatterplot.pdf", plot = pH_amb_fec_no_atresia_weight_adj_scatterplot, device = "pdf")

ggsave(filename = "data-images/pH_amb_fec_no_atresia_weight_adj_scatterplot.png", plot = pH_amb_fec_no_atresia_weight_adj_scatterplot, device = "png")

```

pH Boxplot
```{r}
# pH boxplot

# Amb_Fec Samples No Atresia Ids
pH_amb_fec_no_atresia_boxplot <- ggplot(data = Amb_Fec_No_Atresia_Samples) + 
  geom_boxplot(aes(x = Fecundity_Class, y = pH)) +
  geom_point(aes(x = Fecundity_Class, y = pH), alpha = 0.5, colour = "black") +
  labs(title = "pH", x = "Fecundity Class", y = "pH") +
   facet_wrap(~ Ambient.Or.OAH) +
  theme_classic() +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        title = element_text(size = 12),
        plot.title = element_text(size = 30, hjust = 0.5),
        axis.text.x = element_text(size = 9),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(pH_amb_fec_no_atresia_boxplot)

ggsave(filename = "data-images/pH_amb_fec_no_atresia_boxplot.pdf", plot = pH_amb_fec_no_atresia_boxplot, device = "pdf")
ggsave(filename = "data-images/pH_amb_fec_no_atresia_boxplot.png", plot = pH_amb_fec_no_atresia_boxplot, device = "png")


```





pH Boxplot
```{r}
# pH boxplot

# Amb_Fec Samples with Atresia Ids
pH_amb_fec_boxplot <- ggplot(data = Amb_Fec_Samples) + 
  geom_boxplot(aes(x = Fecundity_Class, y = pH)) +
  geom_point(aes(x = Fecundity_Class, y = pH), alpha = 0.5, colour = "black") +
  labs(title = "pH", x = "Fecundity Class", y = "pH") +
   facet_wrap(~ Ambient.Or.OAH) +
  theme_classic() +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        title = element_text(size = 12),
        plot.title = element_text(size = 30, hjust = 0.5),
        axis.text.x = element_text(size = 9),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(pH_amb_fec_boxplot)

ggsave(filename = "data-images/pH_amb_fec_boxplot.pdf", plot = pH_amb_fec_boxplot, device = "pdf")
ggsave(filename = "data-images/pH_amb_fec_boxplot.png", plot = pH_amb_fec_boxplot, device = "png")


```



pH Parametric Assessment
Data Distribution
```{r}
# pH
# Parametric Assumptions

# Data Distribution


# Amb Fec Samples 
# Frequency Histograms

hist(Amb_Fec_Samples$pH)

plotNormalHistogram(Amb_Fec_Samples$pH) 

# Density plot

Amb_Fec_Samples %>%
  ggplot(aes(x = pH)) +
  stat_function(fun = dnorm, args = c(mean = mean(Amb_Fec_Samples$pH), sd = sd(Amb_Fec_Samples$pH)), aes(col = "Normal Distribution"), show.legend = TRUE) +
  geom_density(aes(col = "Sample Density"), show.legend = TRUE) +
  labs(title = "pH Weight Adj Fecundity Sample Distribution") +
  scale_color_manual("Distribution", values = c("Normal Distribution" = "green", "Sample Density" = "black"))

# Density by brood condition
Amb_Fec_Samples %>%
ggplot(aes(x = pH)) +
  geom_density(aes(x = pH, fill = Fecundity_Class), alpha = 0.5) 

ggplot(Amb_Fec_Samples, aes(x = pH)) +
  geom_density(aes(x = pH)) +
  facet_wrap(Fecundity_Class ~ Ambient.Or.OAH) 

plotNormalDensity(Amb_Fec_Samples$pH)

```

```{r}
# Amb Fec No Atresia Samples 
# Frequency Histograms

hist(Amb_Fec_No_Atresia_Samples$pH)

plotNormalHistogram(Amb_Fec_No_Atresia_Samples$pH) 

# Density plot

Amb_Fec_No_Atresia_Samples %>%
  ggplot(aes(x = pH)) +
  stat_function(fun = dnorm, args = c(mean = mean(Amb_Fec_No_Atresia_Samples$pH), sd = sd(Amb_Fec_No_Atresia_Samples$pH)), aes(col = "Normal Distribution"), show.legend = TRUE) +
  geom_density(aes(col = "Sample Density"), show.legend = TRUE) +
  labs(title = "pH Weight Adj Fecundity Sample Distribution") +
  scale_color_manual("Distribution", values = c("Normal Distribution" = "green", "Sample Density" = "black"))

# Density by brood condition
Amb_Fec_No_Atresia_Samples %>%
ggplot(aes(x = pH)) +
  geom_density(aes(x = pH, fill = Fecundity_Class), alpha = 0.5) 

ggplot(Amb_Fec_No_Atresia_Samples, aes(x = pH)) +
  geom_density(aes(x = pH)) +
  facet_wrap(Fecundity_Class ~ Ambient.Or.OAH) 

plotNormalDensity(Amb_Fec_No_Atresia_Samples$pH)
```



# pH Stat Tests

Model Design
```{r}
# pH

# Install flexplot
# devtools::install_github("dustinfife/flexplot", ref="development")
require(flexplot)

# Amb Fec No Atresia regression model

pH_amb_fec_no_atresia_lm <- lm(pH ~ All_Fecundity, data = Amb_Fec_No_Atresia_Samples)

pH_amb_fec_no_atresia_lm_res <- residuals(pH_amb_fec_no_atresia_lm)

# p-value significant if (a < 0.1 or a < 0.05)
summary(pH_amb_fec_no_atresia_lm)

pH_amb_fec_no_atresia_lm_res_plot <- simulateResiduals(fittedModel = pH_amb_fec_no_atresia_lm)
plot(pH_amb_fec_no_atresia_lm_res_plot)

shapiro.test(pH_amb_fec_no_atresia_lm_res)

# scedasticity test requires a categorical variable 

```

Results: Ambient Fecundity No Atresia Sample

- No significant relationship between pH and weight-adj fecundity (Multiple R-squared:  0.04611, p-value: 0.6096)

Parametric Assumptions: Across Sample comparisons...

- Sample size (n > 30): **Not Met**

- Normality: **Met**

- Homoscedasticity: **???**


Residuals Plot (if significant)
```{r}
# pH
# ggplot with geom_smooth(aes(x=,y=)), method = "lm")


```


Model For Fecundity Class
```{r}
# pH
# Amb Fec No Atresia Class regression model

pH_amb_fec_no_atresia_aov_cat <- aov(pH ~ Fecundity_Class, data = Amb_Fec_No_Atresia_Samples)

summary(pH_amb_fec_no_atresia_aov_cat)

TukeyHSD(pH_amb_fec_no_atresia_aov_cat)

# Normality test
shapiro.test(Amb_Fec_No_Atresia_Samples$pH)

# Parametric variance test:
bartlett.test(pH ~ Fecundity_Class, data = Amb_Fec_No_Atresia_Samples)

# Nonparametric variance test:
# Levene's test requires a categorical variable 
#LeveneTest(pH ~ Fecundity_Class, data = Amb_Fec_No_Atresia_Samples)

```

Results: Ambient Fecundity No Atresia Sample

- No significant difference in pH between fecundity classes: Low (~1,000s) vs. High (>50,000) (p adj = 0.5872711)


Parametric Assumptions: Across Sample comparisons...

- Sample size (n > 30): **Not Met**

- Normality: **Met**

- Homoscedasticity: **Met**


Model For Fecundity Class (With Atresia)
```{r}
# pH
# Amb Fec Class regression model

pH_amb_fec_aov_cat <- aov(pH ~ Fecundity_Class, data = Amb_Fec_Samples)

summary(pH_amb_fec_aov_cat)

TukeyHSD(pH_amb_fec_aov_cat)

# Normality test:
shapiro.test(Amb_Fec_Samples$pH)

# Parametric variance test:
bartlett.test(pH ~ Fecundity_Class, data = Amb_Fec_Samples)

# Nonparametric variance test:
# Levene's test requires a categorical variable 
#LeveneTest(pH ~ Fecundity_Class, data = Amb_Fec_Samples)

```

Results: Ambient Fecundity Sample (With Atresia)

- No significant difference in pH between fecundity classes: Low (~1,000s), High (>50,000), and Atresia 
- Evidence: Pr(>F) = 0.288


Parametric Assumptions: Across Sample comparisons...

- Sample size (n > 30): **Not Met**

- Normality: **Met**

- Homoscedasticity: **Met**



Test For Outliers if warranted
```{r}
# Test for Outliers


```

# Hct : Hematocrit


Hct Summary Stats
```{r}
# hct
# Summary stats

# Amb Fec data (with atresia IDs)
Amb_Fec_Samples %>%
  group_by(Ambient.Or.OAH, Fecundity_Class) %>%
  summarize(count = n(),
            median = round(median(Hct....), 3),
            mean = round(mean(Hct....), 3),
            sd = round(sd(Hct....), 3),
            cv = round(sd(Hct....)/mean(Hct....), 3)) %>%
  ungroup()

# Amb Fec No Atresia data
Amb_Fec_No_Atresia_Samples %>%
  group_by(Ambient.Or.OAH, Fecundity_Class) %>%
  summarize(count = n(),
            median = round(median(Hct....), 3),
            mean = round(mean(Hct....), 3),
            sd = round(sd(Hct....), 3),
            cv = round(sd(Hct....)/mean(Hct....), 3)) %>%
  ungroup()

```



Data Graphs:

```{r}
# Hct
# Weight adjusted scatterplot 

# Amb Fec only scatterplot: atresia ids removed
hct_amb_fec_no_atresia_weight_adj_scatterplot <- ggplot(data = Amb_Fec_No_Atresia_Samples) + 
  geom_point(aes(x = Hct...., y = Weight_Adjusted_Fecundity_Fecundity.Mean_Weight), colour = "black") +
  labs(title = "Hematocrit", x = "Hct (%)", y = "Weight Adjusted Fecundity") +
  scale_y_continuous() + 
  theme_classic() +
  facet_wrap(~ Ambient.Or.OAH) +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        plot.title = element_text(size = 25, hjust = 0.5),
        axis.text.x = element_text(size = 20),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(hct_amb_fec_no_atresia_weight_adj_scatterplot)

ggsave(filename = "data-images/hct_amb_fec_no_atresia_weight_adj_scatterplot.pdf", plot = hct_amb_fec_no_atresia_weight_adj_scatterplot, device = "pdf")

ggsave(filename = "data-images/hct_amb_fec_no_atresia_weight_adj_scatterplot.png", plot = hct_amb_fec_no_atresia_weight_adj_scatterplot, device = "png")

```


Hct Boxplot
```{r}
# Hct boxplot

# Amb_Fec Samples No Atresia Ids
hct_amb_fec_no_atresia_boxplot <- ggplot(data = Amb_Fec_No_Atresia_Samples) + 
  geom_boxplot(aes(x = Fecundity_Class, y = Hct....)) +
  geom_point(aes(x = Fecundity_Class, y = Hct....), alpha = 0.5, colour = "black") +
  labs(title = "Hematocrit", x = "Fecundity Class", y = "Hct (%)") +
   facet_wrap(~ Ambient.Or.OAH) +
  theme_classic() +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        title = element_text(size = 12),
        plot.title = element_text(size = 30, hjust = 0.5),
        axis.text.x = element_text(size = 9),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(hct_amb_fec_no_atresia_boxplot)

ggsave(filename = "data-images/hct_amb_fec_no_atresia_boxplot.pdf", plot = hct_amb_fec_no_atresia_boxplot, device = "pdf")
ggsave(filename = "data-images/hct_amb_fec_no_atresia_boxplot.png", plot = hct_amb_fec_no_atresia_boxplot, device = "png")


```

Hct Boxplot
```{r}
# Hct boxplot

# Amb_Fec Samples with Atresia Ids
hct_amb_fec_boxplot <- ggplot(data = Amb_Fec_Samples) + 
  geom_boxplot(aes(x = Fecundity_Class, y = Hct....)) +
  geom_point(aes(x = Fecundity_Class, y = pH), alpha = 0.5, colour = "black") +
  labs(title = "Hematocrit", x = "Fecundity Class", y = "Hct (%)") +
   facet_wrap(~ Ambient.Or.OAH) +
  theme_classic() +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        title = element_text(size = 12),
        plot.title = element_text(size = 30, hjust = 0.5),
        axis.text.x = element_text(size = 9),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(hct_amb_fec_boxplot)

ggsave(filename = "data-images/hct_amb_fec_boxplot.pdf", plot = hct_amb_fec_boxplot, device = "pdf")
ggsave(filename = "data-images/hct_amb_fec_boxplot.png", plot = hct_amb_fec_boxplot, device = "png")


```


Hct Parametric Assessment
Data Distribution
```{r}
# hct
# Parametric Assumptions

# Data Distribution


# Amb Fec Samples 
# Frequency Histograms

hist(Amb_Fec_Samples$Hct....)

plotNormalHistogram(Amb_Fec_Samples$Hct....) 

# Density plot

Amb_Fec_Samples %>%
  ggplot(aes(x = Hct....)) +
  stat_function(fun = dnorm, args = c(mean = mean(Amb_Fec_Samples$Hct....), sd = sd(Amb_Fec_Samples$Hct....)), aes(col = "Normal Distribution"), show.legend = TRUE) +
  geom_density(aes(col = "Sample Density"), show.legend = TRUE) +
  labs(title = "Hematocrit Weight Adj Fecundity Sample Distribution") +
  scale_color_manual("Distribution", values = c("Normal Distribution" = "green", "Sample Density" = "black"))

# Density by brood condition
Amb_Fec_Samples %>%
ggplot(aes(x = Hct....)) +
  geom_density(aes(x = Hct...., fill = Fecundity_Class), alpha = 0.5) 

ggplot(Amb_Fec_Samples, aes(x = Hct....)) +
  geom_density(aes(x = Hct....)) +
  facet_wrap(Fecundity_Class ~ Ambient.Or.OAH) 

plotNormalDensity(Amb_Fec_Samples$Hct....)

```

```{r}
# Hct
# Amb Fec No Atresia Samples 
# Frequency Histograms

hist(Amb_Fec_No_Atresia_Samples$Hct....)

plotNormalHistogram(Amb_Fec_No_Atresia_Samples$Hct....) 

# Density plot

Amb_Fec_No_Atresia_Samples %>%
  ggplot(aes(x = Hct....)) +
  stat_function(fun = dnorm, args = c(mean = mean(Amb_Fec_No_Atresia_Samples$Hct....), sd = sd(Amb_Fec_No_Atresia_Samples$Hct....)), aes(col = "Normal Distribution"), show.legend = TRUE) +
  geom_density(aes(col = "Sample Density"), show.legend = TRUE) +
  labs(title = "Hematocrit Weight Adj Fecundity Sample Distribution") +
  scale_color_manual("Distribution", values = c("Normal Distribution" = "green", "Sample Density" = "black"))

# Density by brood condition
Amb_Fec_No_Atresia_Samples %>%
ggplot(aes(x = Hct....)) +
  geom_density(aes(x = Hct...., fill = Fecundity_Class), alpha = 0.5) 

ggplot(Amb_Fec_No_Atresia_Samples, aes(x = Hct....)) +
  geom_density(aes(x = Hct....)) +
  facet_wrap(Fecundity_Class ~ Ambient.Or.OAH) 

plotNormalDensity(Amb_Fec_No_Atresia_Samples$Hct....)
```



# Hct Stat Tests

Model Design
```{r}
# Hct

# Amb Fec No Atresia regression model

hct_amb_fec_no_atresia_lm <- lm(Hct.... ~ All_Fecundity, data = Amb_Fec_No_Atresia_Samples)

hct_amb_fec_no_atresia_lm_res <- residuals(hct_amb_fec_no_atresia_lm)

# p-value significant if (a < 0.1 or a < 0.05)
summary(hct_amb_fec_no_atresia_lm)

hct_amb_fec_no_atresia_lm_res_plot <- simulateResiduals(fittedModel = hct_amb_fec_no_atresia_lm)
plot(hct_amb_fec_no_atresia_lm_res_plot)

# Normality test
shapiro.test(hct_amb_fec_no_atresia_lm_res)

# scedasticity test requires a categorical variable 

# Non-parametric stat test:
kruskal.test(Hct.... ~ All_Fecundity, data = Amb_Fec_No_Atresia_Samples)

#DunnTest(Hct.... ~ All_Fecundity, data = Amb_Fec_No_Atresia_Samples)
# Not greatest method for this test...

```

Check Dispersion or Outliers
```{r}

plotResiduals(hct_amb_fec_no_atresia_lm)

testDispersion(hct_amb_fec_no_atresia_lm)

```


Results: Ambient Fecundity No Atresia Sample

- **Significant** relationship detected between Hct and weight-adj fecundity (Multiple R-squared: 0.3952, p-value: 0.09503).


Parametric Assumptions: 

- Sample size (n > 30): **Not Met**

- Normality: **Not Met, shapiro.test p-value = 0.07467**

- Homoscedasticity: **???**

- DARMA Problems detected: Indicate potential overdispersion???

Non-parametric Results:
- *No significant* relationship detected between Hct and weight-adj fecundity.
- Evidence: Kruskal-Wallis chi-squared = 7, df = 7, p-value = 0.4289


Residuals Plot (if significant)
```{r}
# Hct
# ggplot with geom_smooth(aes(x=,y=)), method = "lm")

# Amb Fec only scatterplot: atresia ids removed
hct_amb_fec_no_atresia_weight_adj_lm_scatterplot <- ggplot(data = Amb_Fec_No_Atresia_Samples) + 
  geom_point(aes(x = Hct...., y = Weight_Adjusted_Fecundity_Fecundity.Mean_Weight), colour = "black") +
  geom_smooth(aes(x = Hct...., y = Weight_Adjusted_Fecundity_Fecundity.Mean_Weight), method = "lm") +
  labs(title = "Hematocrit", x = "Hct (%)", y = "Weight Adjusted Fecundity") +
  scale_y_continuous() + 
  theme_classic() +
  facet_wrap(~ Ambient.Or.OAH) +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        plot.title = element_text(size = 25, hjust = 0.5),
        axis.text.x = element_text(size = 20),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(hct_amb_fec_no_atresia_weight_adj_lm_scatterplot)

ggsave(filename = "data-images/hct_amb_fec_no_atresia_weight_adj_lm_scatterplot.pdf", plot = hct_amb_fec_no_atresia_weight_adj_lm_scatterplot, device = "pdf")

ggsave(filename = "data-images/hct_amb_fec_no_atresia_weight_adj_lm_scatterplot.png", plot = hct_amb_fec_no_atresia_weight_adj_lm_scatterplot, device = "png")

```



Model For Fecundity Class (No Atresia)
```{r}
# Hct
# Amb Fec No Atresia Class regression model

hct_amb_fec_no_atresia_aov_cat <- aov(Hct.... ~ Fecundity_Class, data = Amb_Fec_No_Atresia_Samples)

summary(hct_amb_fec_no_atresia_aov_cat)

TukeyHSD(hct_amb_fec_no_atresia_aov_cat)

# Normality test
shapiro.test(Amb_Fec_No_Atresia_Samples$Hct....)

# Parametric variance test:
bartlett.test(Hct.... ~ Fecundity_Class, data = Amb_Fec_No_Atresia_Samples)

# Non-parametric variance test:
# Levene's test requires a categorical variable
#LeveneTest(Hct.... ~ Fecundity_Class, data = Amb_Fec_No_Atresia_Samples)

```

Results: Ambient Fecundity No Atresia Sample

- No significant difference in Hct between fecundity classes: Low (~1,000s) vs. High (>50,000) (p adj = 0.2167991)


Parametric Assumptions: Across Sample comparisons...

- Sample size (n > 30): **Not Met**

- Normality: **Met**

- Homoscedasticity: **Met**


Model For Fecundity Class (With Atresia)
```{r}
# Hct
# Amb Fec Class regression model

hct_amb_fec_aov_cat <- aov(Hct.... ~ Fecundity_Class, data = Amb_Fec_Samples)

summary(hct_amb_fec_aov_cat)

TukeyHSD(hct_amb_fec_aov_cat)

# Normality test
shapiro.test(Amb_Fec_Samples$Hct....)

# Parametric variance test:
bartlett.test(Hct.... ~ Fecundity_Class, data = Amb_Fec_Samples)

# Non-parametric variance test:
# Levene's test requires a categorical variable
#LeveneTest(Hct.... ~ Fecundity_Class, data = Amb_Fec_Samples)

```
Results: Ambient Fecundity Sample (With Atresia)

- A **significant** difference in Hct between fecundity classes: Low (~1,000s), High (>50,000), and Atresia 
- Evidence: Pr(>F) = 0.021 *

- Atresia-Low (~1,000s) significantly different (p adj = 0.0162654).
  - Atresia group display a significant increase in hematocrit compared to Low     fecundity group


Parametric Assumptions: Across Sample comparisons...

- Sample size (n > 30): **Not Met**

- Normality: **Met**

- Homoscedasticity: **Met**




# Glucose

Glucose Summary Stats
```{r}
# glucose
# Summary stats

# Amb Fec data (with atresia IDs)
Amb_Fec_Samples %>%
  group_by(Ambient.Or.OAH, Fecundity_Class) %>%
  summarize(count = n(),
            median = round(median(Glu..mmol.L.), 3),
            mean = round(mean(Glu..mmol.L.), 3),
            sd = round(sd(Glu..mmol.L.), 3),
            cv = round(sd(Glu..mmol.L.)/mean(Glu..mmol.L.), 3)) %>%
  ungroup()

# Amb Fec No Atresia data
Amb_Fec_No_Atresia_Samples %>%
  group_by(Ambient.Or.OAH, Fecundity_Class) %>%
  summarize(count = n(),
            median = round(median(Glu..mmol.L.), 3),
            mean = round(mean(Glu..mmol.L.), 3),
            sd = round(sd(Glu..mmol.L.), 3),
            cv = round(sd(Glu..mmol.L.)/mean(Glu..mmol.L.), 3)) %>%
  ungroup()

```



Data Graphs:

```{r}
# glucose
# Weight adjusted scatterplot 

# Amb Fec only scatterplot: atresia ids removed
glucose_amb_fec_no_atresia_weight_adj_scatterplot <- ggplot(data = Amb_Fec_No_Atresia_Samples) + 
  geom_point(aes(x = Glu..mmol.L., y = Weight_Adjusted_Fecundity_Fecundity.Mean_Weight), colour = "black") +
  labs(title = "Glucose", x = "Glucose (mmol/L)", y = "Weight Adjusted Fecundity") +
  scale_y_continuous() + 
  theme_classic() +
  facet_wrap(~ Ambient.Or.OAH) +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        plot.title = element_text(size = 25, hjust = 0.5),
        axis.text.x = element_text(size = 20),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(glucose_amb_fec_no_atresia_weight_adj_scatterplot)

ggsave(filename = "data-images/glucose_amb_fec_no_atresia_weight_adj_scatterplot.pdf", plot = glucose_amb_fec_no_atresia_weight_adj_scatterplot, device = "pdf")

ggsave(filename = "data-images/glucose_amb_fec_no_atresia_weight_adj_scatterplot.png", plot = glucose_amb_fec_no_atresia_weight_adj_scatterplot, device = "png")

```


Glucose Boxplot
```{r}
# glucose boxplot

# Amb_Fec Samples No Atresia Ids
glucose_amb_fec_no_atresia_boxplot <- ggplot(data = Amb_Fec_No_Atresia_Samples) + 
  geom_boxplot(aes(x = Fecundity_Class, y = Glu..mmol.L.)) +
  geom_point(aes(x = Fecundity_Class, y = Glu..mmol.L.), alpha = 0.5, colour = "black") +
  labs(title = "Glucose", x = "Fecundity Class", y = "Glucose (mmol/L)") +
   facet_wrap(~ Ambient.Or.OAH) +
  theme_classic() +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        title = element_text(size = 12),
        plot.title = element_text(size = 30, hjust = 0.5),
        axis.text.x = element_text(size = 9),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(glucose_amb_fec_no_atresia_boxplot)

ggsave(filename = "data-images/glucose_amb_fec_no_atresia_boxplot.pdf", plot = glucose_amb_fec_no_atresia_boxplot, device = "pdf")
ggsave(filename = "data-images/glucose_amb_fec_no_atresia_boxplot.png", plot = glucose_amb_fec_no_atresia_boxplot, device = "png")


```



Glucose Boxplot
```{r}
# glucose boxplot

# Amb_Fec Samples with Atresia Ids
glucose_amb_fec_boxplot <- ggplot(data = Amb_Fec_Samples) + 
  geom_boxplot(aes(x = Fecundity_Class, y = Glu..mmol.L.)) +
  geom_point(aes(x = Fecundity_Class, y = Glu..mmol.L.), alpha = 0.5, colour = "black") +
  labs(title = "Glucose", x = "Fecundity Class", y = "Glucose (mmol/L)") +
   facet_wrap(~ Ambient.Or.OAH) +
  theme_classic() +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        title = element_text(size = 12),
        plot.title = element_text(size = 30, hjust = 0.5),
        axis.text.x = element_text(size = 9),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(glucose_amb_fec_boxplot)

ggsave(filename = "data-images/glucose_amb_fec_boxplot.pdf", plot = glucose_amb_fec_boxplot, device = "pdf")
ggsave(filename = "data-images/glucose_amb_fec_boxplot.png", plot = glucose_amb_fec_boxplot, device = "png")


```


Glucose Parametric Assessment
Data Distribution
```{r}
# glucose
# Parametric Assumptions

# Data Distribution


# Amb Fec Samples 
# Frequency Histograms

hist(Amb_Fec_Samples$Glu..mmol.L.)

plotNormalHistogram(Amb_Fec_Samples$Glu..mmol.L.) 

# Density plot

Amb_Fec_Samples %>%
  ggplot(aes(x = Glu..mmol.L.)) +
  stat_function(fun = dnorm, args = c(mean = mean(Amb_Fec_Samples$Glu..mmol.L.), sd = sd(Amb_Fec_Samples$Glu..mmol.L.)), aes(col = "Normal Distribution"), show.legend = TRUE) +
  geom_density(aes(col = "Sample Density"), show.legend = TRUE) +
  labs(title = "Glucose Weight Adj Fecundity Sample Distribution") +
  scale_color_manual("Distribution", values = c("Normal Distribution" = "green", "Sample Density" = "black"))

# Density by brood condition
Amb_Fec_Samples %>%
ggplot(aes(x = Glu..mmol.L.)) +
  geom_density(aes(x = Glu..mmol.L., fill = Fecundity_Class), alpha = 0.5) 

ggplot(Amb_Fec_Samples, aes(x = Glu..mmol.L.)) +
  geom_density(aes(x = Glu..mmol.L.)) +
  facet_wrap(Fecundity_Class ~ Ambient.Or.OAH) 

plotNormalDensity(Amb_Fec_Samples$Glu..mmol.L.)

```



```{r}
# glucose

# Amb Fec No Atresia Samples 
# Frequency Histograms

hist(Amb_Fec_No_Atresia_Samples$Glu..mmol.L.)

plotNormalHistogram(Amb_Fec_No_Atresia_Samples$Glu..mmol.L.) 

# Density plot

Amb_Fec_No_Atresia_Samples %>%
  ggplot(aes(x = Glu..mmol.L.)) +
  stat_function(fun = dnorm, args = c(mean = mean(Amb_Fec_No_Atresia_Samples$Glu..mmol.L.), sd = sd(Amb_Fec_No_Atresia_Samples$Glu..mmol.L.)), aes(col = "Normal Distribution"), show.legend = TRUE) +
  geom_density(aes(col = "Sample Density"), show.legend = TRUE) +
  labs(title = "Glucose Weight Adj Fecundity Sample Distribution") +
  scale_color_manual("Distribution", values = c("Normal Distribution" = "green", "Sample Density" = "black"))

# Density by brood condition
Amb_Fec_No_Atresia_Samples %>%
ggplot(aes(x = Glu..mmol.L.)) +
  geom_density(aes(x = Glu..mmol.L., fill = Fecundity_Class), alpha = 0.5) 

ggplot(Amb_Fec_No_Atresia_Samples, aes(x = Glu..mmol.L.)) +
  geom_density(aes(x = Glu..mmol.L.)) +
  facet_wrap(Fecundity_Class ~ Ambient.Or.OAH) 

plotNormalDensity(Amb_Fec_No_Atresia_Samples$Glu..mmol.L.)
```


# Glucose Stat Tests

Model Design
```{r}
# glucose

# Amb Fec No Atresia regression model

glucose_amb_fec_no_atresia_lm <- lm(Glu..mmol.L. ~ All_Fecundity, data = Amb_Fec_No_Atresia_Samples)

glucose_amb_fec_no_atresia_lm_res <- residuals(glucose_amb_fec_no_atresia_lm)

# p-value significant if (a < 0.1 or a < 0.05)
summary(glucose_amb_fec_no_atresia_lm)

glucose_amb_fec_no_atresia_lm_res_plot <- simulateResiduals(fittedModel = glucose_amb_fec_no_atresia_lm)
plot(glucose_amb_fec_no_atresia_lm_res_plot)

# Normality test
shapiro.test(glucose_amb_fec_no_atresia_lm_res)

# scedasticity test requires a categorical variable 

```

Results: Ambient Fecundity No Atresia Sample

- No significant relationship detected between glucose and weight-adj fecundity (Multiple R-squared:  0.05616,	Adjusted R-squared:  -0.1012 
F-statistic: 0.357 on 1 and 6 DF,  p-value: 0.572)


Parametric Assumptions: 

- Sample size (n > 30): **Not Met**

- Normality: **Met**, shapiro.test p-value = 0.2523**

- Homoscedasticity: **???**


Model For Fecundity Class (No Atresia)
```{r}
# glucose
# Amb Fec No Atresia Class regression model

glucose_amb_fec_no_atresia_aov_cat <- aov(Glu..mmol.L. ~ Fecundity_Class, data = Amb_Fec_No_Atresia_Samples)

summary(glucose_amb_fec_no_atresia_aov_cat)

TukeyHSD(glucose_amb_fec_no_atresia_aov_cat)

# Normality test
shapiro.test(Amb_Fec_No_Atresia_Samples$Glu..mmol.L.)

# Parametric variance test: 
# Bartlett's test requires a categorical variable
bartlett.test(Glu..mmol.L. ~ Fecundity_Class, data = Amb_Fec_No_Atresia_Samples)
# Unequal variance

# Non-parametric variance test:
# Levene's test requires a categorical variable 
LeveneTest(Glu..mmol.L. ~ Fecundity_Class, data = Amb_Fec_No_Atresia_Samples)
# Unequal variance by non-parametric standards

# Non-parametric stat test
kruskal.test(Glu..mmol.L. ~ Fecundity_Class, data = Amb_Fec_No_Atresia_Samples)

```
Results: Ambient Fecundity No Atresia Sample

- No significant difference in glucose between fecundity classes: Low (~1,000s) vs. High (>50,000) (p adj = 0.7899814)


Parametric Assumptions: Across Sample comparisons...

- Sample size (n > 30): **Not Met**

- Normality: **Met**

- Homoscedasticity: **Not Met, nonparametric**
- Evidence: Bartlett's K-squared = 3.4491, df = 1, p-value = 0.06329

- Nonparametric variance test **Does not pass**
- Evidence: Levene's Test for Homogeneity of Variance (center = median), F value = 4.8565, Pr(>F) = 0.06974

Levene's Test Pr(>F) = 0.06974**

Non-Parametric Results:
- No significant difference in glucose between fecundity classes: Low (~1,000s) vs. High (>50,000)
- Evidence: Kruskal-Wallis rank sum test, p-value = 1


Model For Fecundity Class (With Atresia)
```{r}
# Glucose
# Amb Fec Class regression model

glucose_amb_fec_aov_cat <- aov(Glu..mmol.L. ~ Fecundity_Class, data = Amb_Fec_Samples)

summary(glucose_amb_fec_aov_cat)

TukeyHSD(glucose_amb_fec_aov_cat)

# Normality test:
shapiro.test(Amb_Fec_Samples$Glu..mmol.L.)

# Parametric variance test:
# Bartlett's test requires a categorical variable 
bartlett.test(Glu..mmol.L. ~ Fecundity_Class, data = Amb_Fec_Samples)

# Non-parametric variance test:
# Levene's test requires a categorical variable 
#LeveneTest(Glu..mmol.L. ~ Fecundity_Class, data = Amb_Fec_Samples)

# Non-parametric stat test:
kruskal.test(Glu..mmol.L. ~ Fecundity_Class, data = Amb_Fec_Samples)

DunnTest(Glu..mmol.L. ~ Fecundity_Class, data = Amb_Fec_Samples)
```

Results: Ambient Fecundity Sample (With Atresia)

- **No significant** difference in glucose between fecundity classes: Low (~1,000s), High (>50,000), and Atresia 
- Evidence: Pr(>F) = 0.293*


Parametric Assumptions: Across Sample comparisons...

- Sample size (n > 30): **Not Met**

- Normality: **Not Met, Shapiro-Wilk Test p-value = 0.005473**

- Homoscedasticity: **Met**

Non-parametric stat test results:
- **No significant** difference in glucose between fecundity classes: Low (~1,000s), High (>50,000), and Atresia
- Evidence: Kruskal-Wallis chi-squared = 4.0755, df = 2, p-value = 0.1303

- Dunns test detects close to significance: 
- Atresia-Low (~1,000s), pval = 0.1778

# Na+ : Soduim 

Sodium Summary Stats
```{r}
# Na+
# Summary stats

# Amb Fec data (with atresia IDs)
Amb_Fec_Samples %>%
  group_by(Ambient.Or.OAH, Fecundity_Class) %>%
  summarize(count = n(),
            median = round(median(Na...mmol.L.), 3),
            mean = round(mean(Na...mmol.L.), 3),
            sd = round(sd(Na...mmol.L.), 3),
            cv = round(sd(Na...mmol.L.)/mean(Na...mmol.L.), 3)) %>%
  ungroup()

# Amb Fec No Atresia data
Amb_Fec_No_Atresia_Samples %>%
  group_by(Ambient.Or.OAH, Fecundity_Class) %>%
  summarize(count = n(),
            median = round(median(Na...mmol.L.), 3),
            mean = round(mean(Na...mmol.L.), 3),
            sd = round(sd(Na...mmol.L.), 3),
            cv = round(sd(Na...mmol.L.)/mean(Na...mmol.L.), 3)) %>%
  ungroup()

```


Data Graphs:

```{r}
# Na+
# Weight adjusted scatterplot 

# Amb Fec only scatterplot: atresia ids removed
sodium_amb_fec_no_atresia_weight_adj_scatterplot <- ggplot(data = Amb_Fec_No_Atresia_Samples) + 
  geom_point(aes(x = Hct...., y = Weight_Adjusted_Fecundity_Fecundity.Mean_Weight), colour = "black") +
  labs(title = "Sodium", x = "Sodium (mmol/L)", y = "Weight Adjusted Fecundity") +
  scale_y_continuous() + 
  theme_classic() +
  facet_wrap(~ Ambient.Or.OAH) +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        plot.title = element_text(size = 25, hjust = 0.5),
        axis.text.x = element_text(size = 20),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(sodium_amb_fec_no_atresia_weight_adj_scatterplot)

ggsave(filename = "data-images/sodium_amb_fec_no_atresia_weight_adj_scatterplot.pdf", plot = sodium_amb_fec_no_atresia_weight_adj_scatterplot, device = "pdf")

ggsave(filename = "data-images/sodium_amb_fec_no_atresia_weight_adj_scatterplot.png", plot = sodium_amb_fec_no_atresia_weight_adj_scatterplot, device = "png")

```


Sodium Boxplot (No Atresia)
```{r}
# Na+ boxplot

# Amb_Fec Samples No Atresia Ids
sodium_amb_fec_no_atresia_boxplot <- ggplot(data = Amb_Fec_No_Atresia_Samples) + 
  geom_boxplot(aes(x = Fecundity_Class, y = Na...mmol.L.)) +
  geom_point(aes(x = Fecundity_Class, y = Na...mmol.L.), alpha = 0.5, colour = "black") +
  labs(title = "Sodium", x = "Fecundity Class", y = "Sodium (mmol/L)") +
   facet_wrap(~ Ambient.Or.OAH) +
  theme_classic() +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        title = element_text(size = 12),
        plot.title = element_text(size = 30, hjust = 0.5),
        axis.text.x = element_text(size = 9),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(sodium_amb_fec_no_atresia_boxplot)

ggsave(filename = "data-images/sodium_amb_fec_no_atresia_boxplot.pdf", plot = sodium_amb_fec_no_atresia_boxplot, device = "pdf")
ggsave(filename = "data-images/sodium_amb_fec_no_atresia_boxplot.png", plot = sodium_amb_fec_no_atresia_boxplot, device = "png")


```


Sodium Boxplot (With Atresia)
```{r}
# Na+ boxplot

# Amb_Fec Samples with Atresia Ids
sodium_amb_fec_boxplot <- ggplot(data = Amb_Fec_Samples) + 
  geom_boxplot(aes(x = Fecundity_Class, y = Na...mmol.L.)) +
  geom_point(aes(x = Fecundity_Class, y = Na...mmol.L.), alpha = 0.5, colour = "black") +
  labs(title = "Sodium", x = "Fecundity Class", y = "Sodium (mmol/L)") +
   facet_wrap(~ Ambient.Or.OAH) +
  theme_classic() +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        title = element_text(size = 12),
        plot.title = element_text(size = 30, hjust = 0.5),
        axis.text.x = element_text(size = 9),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(sodium_amb_fec_boxplot)

ggsave(filename = "data-images/sodium_amb_fec_boxplot.pdf", plot = sodium_amb_fec_boxplot, device = "pdf")
ggsave(filename = "data-images/sodium_amb_fec_boxplot.png", plot = sodium_amb_fec_boxplot, device = "png")


```


Sodium Parametric Assessment
Data Distribution
```{r}
# Na+
# Parametric Assumptions

# Data Distribution


# Amb Fec Samples 
# Frequency Histograms

hist(Amb_Fec_Samples$Na...mmol.L.)

plotNormalHistogram(Amb_Fec_Samples$Na...mmol.L.) 

# Density plot

Amb_Fec_Samples %>%
  ggplot(aes(x = Na...mmol.L.)) +
  stat_function(fun = dnorm, args = c(mean = mean(Amb_Fec_Samples$Na...mmol.L.), sd = sd(Amb_Fec_Samples$Na...mmol.L.)), aes(col = "Normal Distribution"), show.legend = TRUE) +
  geom_density(aes(col = "Sample Density"), show.legend = TRUE) +
  labs(title = "Sodium Weight Adj Fecundity Sample Distribution") +
  scale_color_manual("Distribution", values = c("Normal Distribution" = "green", "Sample Density" = "black"))

# Density by brood condition
Amb_Fec_Samples %>%
ggplot(aes(x = Na...mmol.L.)) +
  geom_density(aes(x = Na...mmol.L., fill = Fecundity_Class), alpha = 0.5) 

ggplot(Amb_Fec_Samples, aes(x = Na...mmol.L.)) +
  geom_density(aes(x = Na...mmol.L.)) +
  facet_wrap(Fecundity_Class ~ Ambient.Or.OAH) 

plotNormalDensity(Amb_Fec_Samples$Na...mmol.L.)

```


```{r}
# Na+

# Amb Fec No Atresia Samples 
# Frequency Histograms

hist(Amb_Fec_No_Atresia_Samples$Na...mmol.L.)

plotNormalHistogram(Amb_Fec_No_Atresia_Samples$Na...mmol.L.) 

# Density plot

Amb_Fec_No_Atresia_Samples %>%
  ggplot(aes(x = Na...mmol.L.)) +
  stat_function(fun = dnorm, args = c(mean = mean(Amb_Fec_No_Atresia_Samples$Na...mmol.L.), sd = sd(Amb_Fec_No_Atresia_Samples$Na...mmol.L.)), aes(col = "Normal Distribution"), show.legend = TRUE) +
  geom_density(aes(col = "Sample Density"), show.legend = TRUE) +
  labs(title = "Sodium Weight Adj Fecundity Sample Distribution") +
  scale_color_manual("Distribution", values = c("Normal Distribution" = "green", "Sample Density" = "black"))

# Density by brood condition
Amb_Fec_No_Atresia_Samples %>%
ggplot(aes(x = Na...mmol.L.)) +
  geom_density(aes(x = Na...mmol.L., fill = Fecundity_Class), alpha = 0.5) 

ggplot(Amb_Fec_No_Atresia_Samples, aes(x = Na...mmol.L.)) +
  geom_density(aes(x = Na...mmol.L.)) +
  facet_wrap(Fecundity_Class ~ Ambient.Or.OAH) 

plotNormalDensity(Amb_Fec_No_Atresia_Samples$Na...mmol.L.)
```


# Na+ Stat Tests

Model Design
```{r}
# Na+

# Amb Fec No Atresia regression model

sodium_amb_fec_no_atresia_lm <- lm(Na...mmol.L. ~ All_Fecundity, data = Amb_Fec_No_Atresia_Samples)

sodium_amb_fec_no_atresia_lm_res <- residuals(sodium_amb_fec_no_atresia_lm)

# p-value significant if (a < 0.1 or a < 0.05)
summary(sodium_amb_fec_no_atresia_lm)

sodium_amb_fec_no_atresia_lm_res_plot <- simulateResiduals(fittedModel = sodium_amb_fec_no_atresia_lm)
plot(sodium_amb_fec_no_atresia_lm_res_plot)

# Normality test
shapiro.test(sodium_amb_fec_no_atresia_lm_res)

# scedasticity test requires a categorical variable 

```

Results: Ambient Fecundity No Atresia Sample

- No significant relationship detected between glucose and weight-adj fecundity (Multiple R-squared:  0.04842,	Adjusted R-squared:  -0.1102 
F-statistic: 0.3053 on 1 and 6 DF,  p-value: 0.6005)


Parametric Assumptions: 

- Sample size (n > 30): **Not Met**

- Normality: **Met**

- Homoscedasticity: **???**


Model For Fecundity Class (No Atresia)
```{r}
# sodium
# Amb Fec No Atresia Class regression model

sodium_amb_fec_no_atresia_aov_cat <- aov(Na...mmol.L. ~ Fecundity_Class, data = Amb_Fec_No_Atresia_Samples)

summary(sodium_amb_fec_no_atresia_aov_cat)

TukeyHSD(sodium_amb_fec_no_atresia_aov_cat)

# Normality Test
shapiro.test(Amb_Fec_No_Atresia_Samples$Na...mmol.L.)

# Parametric variance test: 
# Bartlett's test requires a categorical variable
bartlett.test(Na...mmol.L. ~ Fecundity_Class, data = Amb_Fec_No_Atresia_Samples)

# Nonparametric variance test:
# Levene's test requires a categorical variable 
#LeveneTest(Na...mmol.L. ~ Fecundity_Class, data = Amb_Fec_No_Atresia_Samples)

```

Results: Ambient Fecundity No Atresia Sample

- No significant difference in sodium between fecundity classes: Low (~1,000s) vs. High (>50,000) (p adj = 0.4498648)


Parametric Assumptions: Across Sample comparisons...

- Sample size (n > 30): **Not Met**

- Normality: **Met**

- Homoscedasticity: **Met**


Model For Fecundity Class (With Atresia)
```{r}
# Na+
# Amb Fec Class regression model

sodium_amb_fec_aov_cat <- aov(Na...mmol.L. ~ Fecundity_Class, data = Amb_Fec_Samples)

summary(sodium_amb_fec_aov_cat)

TukeyHSD(sodium_amb_fec_aov_cat)

# Normality test
shapiro.test(Amb_Fec_Samples$Na...mmol.L.) # not normal distribution

# Parametric variance test:
# Bartlett's test requires a categorical variable
bartlett.test(Na...mmol.L. ~ Fecundity_Class, data = Amb_Fec_Samples) 
# not normal

# Nonparametric variance test:
# Levene's test requires a categorical variable 
LeveneTest(Na...mmol.L. ~ Fecundity_Class, data = Amb_Fec_Samples)
# passes nonparametric standards

# Nonparametric test

kruskal.test(Na...mmol.L. ~ Fecundity_Class, data = Amb_Fec_Samples)

```


Results: Ambient Fecundity Sample (With Atresia)

- **No significant** difference detected in glucose between fecundity classes: Low (~1,000s), High (>50,000), and Atresia 
- Evidence: Pr(>F) = 0.438


Parametric Assumptions: Across Sample comparisons...

- Sample size (n > 30): **Not Met**

- Normality: **Not Met, Shapiro-Wilk Test p-value = 3.625e-07**

- Homoscedasticity: **Not met, nonparametric**
- Evidence: Bartlett's K-squared = 7.4634, df = 2, p-value = 0.02395

- Nonparametric variance test passes
- Evidence: Levene's Test for Homogeneity of Variance (center = median), F value = 0.2098, Pr(>F) = 0.8127

- Non-parametric results: 
- *No significant* difference detected in glucose between fecundity classes: Low (~1,000s), High (>50,000), and Atresia 
- Evidence: Kruskal-Wallis chi-squared = 2.8608, df = 2, p-value = 0.2392



# Cl- : Chloride

Chloride Summary Stats
```{r}
# Cl-
# Summary stats

# Amb Fec data (with atresia IDs)
Amb_Fec_Samples %>%
  group_by(Ambient.Or.OAH, Fecundity_Class) %>%
  summarize(count = n(),
            median = round(median(Cl...mmol.L.), 3),
            mean = round(mean(Cl...mmol.L.), 3),
            sd = round(sd(Cl...mmol.L.), 3),
            cv = round(sd(Cl...mmol.L.)/mean(Cl...mmol.L.), 3)) %>%
  ungroup()

# Amb Fec No Atresia data
Amb_Fec_No_Atresia_Samples %>%
  group_by(Ambient.Or.OAH, Fecundity_Class) %>%
  summarize(count = n(),
            median = round(median(Cl...mmol.L.), 3),
            mean = round(mean(Cl...mmol.L.), 3),
            sd = round(sd(Cl...mmol.L.), 3),
            cv = round(sd(Cl...mmol.L.)/mean(Cl...mmol.L.), 3)) %>%
  ungroup()

```


Data Graphs:

```{r}
# Cl-
# Weight adjusted scatterplot 

# Amb Fec only scatterplot: atresia ids removed
chloride_amb_fec_no_atresia_weight_adj_scatterplot <- ggplot(data = Amb_Fec_No_Atresia_Samples) + 
  geom_point(aes(x = Cl...mmol.L., y = Weight_Adjusted_Fecundity_Fecundity.Mean_Weight), colour = "black") +
  labs(title = "Chloride", x = "Chloride (mmol/L)", y = "Weight Adjusted Fecundity") +
  scale_y_continuous() + 
  theme_classic() +
  facet_wrap(~ Ambient.Or.OAH) +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        plot.title = element_text(size = 25, hjust = 0.5),
        axis.text.x = element_text(size = 20),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(chloride_amb_fec_no_atresia_weight_adj_scatterplot)

ggsave(filename = "data-images/chloride_amb_fec_no_atresia_weight_adj_scatterplot.pdf", plot = chloride_amb_fec_no_atresia_weight_adj_scatterplot, device = "pdf")

ggsave(filename = "data-images/chloride_amb_fec_no_atresia_weight_adj_scatterplot.png", plot = chloride_amb_fec_no_atresia_weight_adj_scatterplot, device = "png")

```



Chloride Boxplot (No Atresia)
```{r}
# Cl- boxplot

# Amb_Fec Samples No Atresia Ids
chloride_amb_fec_no_atresia_boxplot <- ggplot(data = Amb_Fec_No_Atresia_Samples) + 
  geom_boxplot(aes(x = Fecundity_Class, y = Cl...mmol.L.)) +
  geom_point(aes(x = Fecundity_Class, y = Cl...mmol.L.), alpha = 0.5, colour = "black") +
  labs(title = "Chloride", x = "Fecundity Class", y = "Chloride (mmol/L)") +
   facet_wrap(~ Ambient.Or.OAH) +
  theme_classic() +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        title = element_text(size = 12),
        plot.title = element_text(size = 30, hjust = 0.5),
        axis.text.x = element_text(size = 9),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(chloride_amb_fec_no_atresia_boxplot)

ggsave(filename = "data-images/chloride_amb_fec_no_atresia_boxplot.pdf", plot = chloride_amb_fec_no_atresia_boxplot, device = "pdf")
ggsave(filename = "data-images/chloride_amb_fec_no_atresia_boxplot.png", plot = chloride_amb_fec_no_atresia_boxplot, device = "png")


```



Chloride Boxplot (With Atresia)
```{r}
# Cl- boxplot

# Amb_Fec Samples with Atresia Ids
chloride_amb_fec_boxplot <- ggplot(data = Amb_Fec_Samples) + 
  geom_boxplot(aes(x = Fecundity_Class, y = Cl...mmol.L.)) +
  geom_point(aes(x = Fecundity_Class, y = Cl...mmol.L.), alpha = 0.5, colour = "black") +
  labs(title = "Chloride", x = "Fecundity Class", y = "Chloride (mmol/L)") +
   facet_wrap(~ Ambient.Or.OAH) +
  theme_classic() +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        title = element_text(size = 12),
        plot.title = element_text(size = 30, hjust = 0.5),
        axis.text.x = element_text(size = 9),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(chloride_amb_fec_boxplot)

ggsave(filename = "data-images/chloride_amb_fec_boxplot.pdf", plot = chloride_amb_fec_boxplot, device = "pdf")
ggsave(filename = "data-images/chloride_amb_fec_boxplot.png", plot = chloride_amb_fec_boxplot, device = "png")


```


Chloride Parametric Assessment
Data Distribution
```{r}
# Cl-
# Parametric Assumptions

# Data Distribution


# Amb Fec Samples 
# Frequency Histograms

hist(Amb_Fec_Samples$Cl...mmol.L.)

plotNormalHistogram(Amb_Fec_Samples$Cl...mmol.L.) 

# Density plot

Amb_Fec_Samples %>%
  ggplot(aes(x = Cl...mmol.L.)) +
  stat_function(fun = dnorm, args = c(mean = mean(Amb_Fec_Samples$Cl...mmol.L.), sd = sd(Amb_Fec_Samples$Cl...mmol.L.)), aes(col = "Normal Distribution"), show.legend = TRUE) +
  geom_density(aes(col = "Sample Density"), show.legend = TRUE) +
  labs(title = "chloride Weight Adj Fecundity Sample Distribution") +
  scale_color_manual("Distribution", values = c("Normal Distribution" = "green", "Sample Density" = "black"))

# Density by brood condition
Amb_Fec_Samples %>%
ggplot(aes(x = Cl...mmol.L.)) +
  geom_density(aes(x = Cl...mmol.L., fill = Fecundity_Class), alpha = 0.5) 

ggplot(Amb_Fec_Samples, aes(x = Cl...mmol.L.)) +
  geom_density(aes(x = Cl...mmol.L.)) +
  facet_wrap(Fecundity_Class ~ Ambient.Or.OAH) 

plotNormalDensity(Amb_Fec_Samples$Cl...mmol.L.)

```



```{r}
# Cl-

# Amb Fec No Atresia Samples 
# Frequency Histograms

hist(Amb_Fec_No_Atresia_Samples$Cl...mmol.L.)

plotNormalHistogram(Amb_Fec_No_Atresia_Samples$Cl...mmol.L.) 

# Density plot

Amb_Fec_No_Atresia_Samples %>%
  ggplot(aes(x = Cl...mmol.L.)) +
  stat_function(fun = dnorm, args = c(mean = mean(Amb_Fec_No_Atresia_Samples$Cl...mmol.L.), sd = sd(Amb_Fec_No_Atresia_Samples$Cl...mmol.L.)), aes(col = "Normal Distribution"), show.legend = TRUE) +
  geom_density(aes(col = "Sample Density"), show.legend = TRUE) +
  labs(title = "Chloride Weight Adj Fecundity Sample Distribution") +
  scale_color_manual("Distribution", values = c("Normal Distribution" = "green", "Sample Density" = "black"))

# Density by brood condition
Amb_Fec_No_Atresia_Samples %>%
ggplot(aes(x = Cl...mmol.L.)) +
  geom_density(aes(x = Cl...mmol.L., fill = Fecundity_Class), alpha = 0.5) 

ggplot(Amb_Fec_No_Atresia_Samples, aes(x = Cl...mmol.L.)) +
  geom_density(aes(x = Cl...mmol.L.)) +
  facet_wrap(Fecundity_Class ~ Ambient.Or.OAH) 

plotNormalDensity(Amb_Fec_No_Atresia_Samples$Cl...mmol.L.)
```



# Cl- Stat Tests 

Model Design
```{r}
# Cl-

# Amb Fec No Atresia regression model

chloride_amb_fec_no_atresia_lm <- lm(Cl...mmol.L. ~ All_Fecundity, data = Amb_Fec_No_Atresia_Samples)

chloride_amb_fec_no_atresia_lm_res <- residuals(chloride_amb_fec_no_atresia_lm)

# p-value significant if (a < 0.1 or a < 0.05)
summary(chloride_amb_fec_no_atresia_lm)

chloride_amb_fec_no_atresia_lm_res_plot <- simulateResiduals(fittedModel = chloride_amb_fec_no_atresia_lm)
plot(chloride_amb_fec_no_atresia_lm_res_plot)

# Normality test
shapiro.test(chloride_amb_fec_no_atresia_lm_res)

# scedasticity test requires a categorical variable 

```

Results: Ambient Fecundity No Atresia Sample

- No significant relationship detected between glucose and weight-adj fecundity 
- Evidence: lm summary, Multiple R-squared: 0.02181,	Adjusted R-squared: -0.1412, F-statistic: 0.1338 on 1 and 6 DF, p-value: 0.7271


Parametric Assumptions: 

- Sample size (n > 30): **Not Met**

- Normality: **Met**

- Homoscedasticity: **???**


Model For Fecundity Class (No Atresia)
```{r}
# Cl-
# Amb Fec No Atresia Class regression model

chloride_amb_fec_no_atresia_aov_cat <- aov(Cl...mmol.L. ~ Fecundity_Class, data = Amb_Fec_No_Atresia_Samples)

summary(chloride_amb_fec_no_atresia_aov_cat)

TukeyHSD(chloride_amb_fec_no_atresia_aov_cat)

# Normality Test
shapiro.test(Amb_Fec_No_Atresia_Samples$Cl...mmol.L.)

# Parametric variance test: 
# Bartlett's test requires a categorical variable
bartlett.test(Cl...mmol.L. ~ Fecundity_Class, data = Amb_Fec_No_Atresia_Samples)

# Nonparametric variance test:
# Levene's test requires a categorical variable 
#LeveneTest(Cl...mmol.L. ~ Fecundity_Class, data = Amb_Fec_No_Atresia_Samples)

```



Results: Ambient Fecundity No Atresia Sample

- No significant difference in sodium between fecundity classes
- Evidence: aov summary Pr(>F) = 0.839
- Evidence: Tukey HSD Low (~1,000s)-High (>50,000) p adj = 0.8394208


Parametric Assumptions: Across Sample comparisons...

- Sample size (n > 30): **Not Met**

- Normality: **Met**

- Homoscedasticity: **Met**


Model For Fecundity Class (With Atresia)
```{r}
# Cl-
# Amb Fec Class regression model

chloride_amb_fec_aov_cat <- aov(Cl...mmol.L. ~ Fecundity_Class, data = Amb_Fec_Samples)

summary(chloride_amb_fec_aov_cat)

TukeyHSD(chloride_amb_fec_aov_cat)

# Normality test
shapiro.test(Amb_Fec_Samples$Cl...mmol.L.) 

# Parametric variance test:
# Bartlett's test requires a categorical variable
bartlett.test(Cl...mmol.L. ~ Fecundity_Class, data = Amb_Fec_Samples) 
# not normal

# Nonparametric variance test:
# Levene's test requires a categorical variable 
#LeveneTest(Cl...mmol.L. ~ Fecundity_Class, data = Amb_Fec_Samples)

```

Results: Ambient Fecundity Sample (With Atresia)

- **No significant** difference detected in glucose between fecundity classes: Low (~1,000s), High (>50,000), and Atresia 
- Evidence: aov summary Pr(>F) = 0.92


Parametric Assumptions: Across Sample comparisons...

- Sample size (n > 30): **Not Met**

- Normality: **Met**

- Homoscedasticity: **Met**


# K+ : Potassium

Potassium Summary Stats
```{r}
# K+
# Summary stats

# Amb Fec data (with atresia IDs)
Amb_Fec_Samples %>%
  group_by(Ambient.Or.OAH, Fecundity_Class) %>%
  summarize(count = n(),
            median = round(median(K...mmol.L.), 3),
            mean = round(mean(K...mmol.L.), 3),
            sd = round(sd(K...mmol.L.), 3),
            cv = round(sd(K...mmol.L.)/mean(K...mmol.L.), 3)) %>%
  ungroup()

# Amb Fec No Atresia data
Amb_Fec_No_Atresia_Samples %>%
  group_by(Ambient.Or.OAH, Fecundity_Class) %>%
  summarize(count = n(),
            median = round(median(K...mmol.L.), 3),
            mean = round(mean(K...mmol.L.), 3),
            sd = round(sd(K...mmol.L.), 3),
            cv = round(sd(K...mmol.L.)/mean(K...mmol.L.), 3)) %>%
  ungroup()

```


Data Graphs:

```{r}
# K+
# Weight adjusted scatterplot 

# Amb Fec only scatterplot: atresia ids removed
potassium_amb_fec_no_atresia_weight_adj_scatterplot <- ggplot(data = Amb_Fec_No_Atresia_Samples) + 
  geom_point(aes(x = K...mmol.L., y = Weight_Adjusted_Fecundity_Fecundity.Mean_Weight), colour = "black") +
  labs(title = "Potassium", x = "Potassium (mmol/L)", y = "Weight Adjusted Fecundity") +
  scale_y_continuous() + 
  theme_classic() +
  facet_wrap(~ Ambient.Or.OAH) +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        plot.title = element_text(size = 25, hjust = 0.5),
        axis.text.x = element_text(size = 20),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(potassium_amb_fec_no_atresia_weight_adj_scatterplot)

ggsave(filename = "data-images/potassium_amb_fec_no_atresia_weight_adj_scatterplot.pdf", plot = potassium_amb_fec_no_atresia_weight_adj_scatterplot, device = "pdf")

ggsave(filename = "data-images/potassium_amb_fec_no_atresia_weight_adj_scatterplot.png", plot = potassium_amb_fec_no_atresia_weight_adj_scatterplot, device = "png")

```


Potassium Boxplot (No Atresia)
```{r}
# K+ boxplot

# Amb_Fec Samples No Atresia Ids
potassium_amb_fec_no_atresia_boxplot <- ggplot(data = Amb_Fec_No_Atresia_Samples) + 
  geom_boxplot(aes(x = Fecundity_Class, y = K...mmol.L.), outlier.shape = NA) +
  # geom_point(aes(x = Fecundity_Class, y = K...mmol.L.), alpha = 0.5, colour = "black") +
  geom_jitter(aes(x = Fecundity_Class, y = K...mmol.L.), alpha = 0.5, colour = "black", width = 0.03, height = 0.03) +
  labs(title = "Potassium", x = "Fecundity Class", y = "Potassium (mmol/L)") +
   facet_wrap(~ Ambient.Or.OAH) +
  theme_classic() +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        title = element_text(size = 12),
        plot.title = element_text(size = 30, hjust = 0.5),
        axis.text.x = element_text(size = 9),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(potassium_amb_fec_no_atresia_boxplot)

ggsave(filename = "data-images/potassium_amb_fec_no_atresia_boxplot.pdf", plot = potassium_amb_fec_no_atresia_boxplot, device = "pdf")
ggsave(filename = "data-images/potassium_amb_fec_no_atresia_boxplot.png", plot = potassium_amb_fec_no_atresia_boxplot, device = "png")


```



Potassium Boxplot (With Atresia)
```{r}
# K+ boxplot

# Amb_Fec Samples with Atresia Ids
potassium_amb_fec_boxplot <- ggplot(data = Amb_Fec_Samples) + 
  geom_boxplot(aes(x = Fecundity_Class, y = K...mmol.L.), outlier.shape = NA) +
#  geom_point(aes(x = Fecundity_Class, y = K...mmol.L.), alpha = 0.5, colour = "black") +
  geom_jitter(aes(x = Fecundity_Class, y = K...mmol.L.), alpha = 0.5, colour = "black", width = 0.03, height = 0.03) +
  labs(title = "Potassium", x = "Fecundity Class", y = "Potassium (mmol/L)") +
   facet_wrap(~ Ambient.Or.OAH) +
  theme_classic() +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        title = element_text(size = 12),
        plot.title = element_text(size = 30, hjust = 0.5),
        axis.text.x = element_text(size = 9),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(potassium_amb_fec_boxplot)

ggsave(filename = "data-images/potassium_amb_fec_boxplot.pdf", plot = potassium_amb_fec_boxplot, device = "pdf")
ggsave(filename = "data-images/potassium_amb_fec_boxplot.png", plot = potassium_amb_fec_boxplot, device = "png")

```


Potassium Parametric Assessment
Data Distribution
```{r}
# K+
# Parametric Assumptions

# Data Distribution

# Amb Fec Samples 
# Frequency Histograms

hist(Amb_Fec_Samples$K...mmol.L.)

plotNormalHistogram(Amb_Fec_Samples$K...mmol.L.) 

# Density plot

Amb_Fec_Samples %>%
  ggplot(aes(x = K...mmol.L.)) +
  stat_function(fun = dnorm, args = c(mean = mean(Amb_Fec_Samples$K...mmol.L.), sd = sd(Amb_Fec_Samples$K...mmol.L.)), aes(col = "Normal Distribution"), show.legend = TRUE) +
  geom_density(aes(col = "Sample Density"), show.legend = TRUE) +
  labs(title = "Potassium Weight Adj Fecundity Sample Distribution") +
  scale_color_manual("Distribution", values = c("Normal Distribution" = "green", "Sample Density" = "black"))

# Density by brood condition
Amb_Fec_Samples %>%
ggplot(aes(x = K...mmol.L.)) +
  geom_density(aes(x = K...mmol.L., fill = Fecundity_Class), alpha = 0.5) 

ggplot(Amb_Fec_Samples, aes(x = K...mmol.L.)) +
  geom_density(aes(x = K...mmol.L.)) +
  facet_wrap(Fecundity_Class ~ Ambient.Or.OAH) 

plotNormalDensity(Amb_Fec_Samples$K...mmol.L.)

```


```{r}
# K+

# Amb Fec No Atresia Samples 
# Frequency Histograms

hist(Amb_Fec_No_Atresia_Samples$K...mmol.L.)

plotNormalHistogram(Amb_Fec_No_Atresia_Samples$K...mmol.L.) 

# Density plot

Amb_Fec_No_Atresia_Samples %>%
  ggplot(aes(x = K...mmol.L.)) +
  stat_function(fun = dnorm, args = c(mean = mean(Amb_Fec_No_Atresia_Samples$K...mmol.L.), sd = sd(Amb_Fec_No_Atresia_Samples$K...mmol.L.)), aes(col = "Normal Distribution"), show.legend = TRUE) +
  geom_density(aes(col = "Sample Density"), show.legend = TRUE) +
  labs(title = "Potassium Weight Adj Fecundity Sample Distribution") +
  scale_color_manual("Distribution", values = c("Normal Distribution" = "green", "Sample Density" = "black"))

# Density by brood condition
Amb_Fec_No_Atresia_Samples %>%
ggplot(aes(x = K...mmol.L.)) +
  geom_density(aes(x = K...mmol.L., fill = Fecundity_Class), alpha = 0.5) 

ggplot(Amb_Fec_No_Atresia_Samples, aes(x = K...mmol.L.)) +
  geom_density(aes(x = K...mmol.L.)) +
  facet_wrap(Fecundity_Class ~ Ambient.Or.OAH) 

plotNormalDensity(Amb_Fec_No_Atresia_Samples$K...mmol.L.)
```



# K+ Stat Tests

Model Design
```{r}
# K+

# Amb Fec No Atresia regression model

potassium_amb_fec_no_atresia_lm <- lm(K...mmol.L. ~ All_Fecundity, data = Amb_Fec_No_Atresia_Samples)

potassium_amb_fec_no_atresia_lm_res <- residuals(potassium_amb_fec_no_atresia_lm)

# p-value significant if (a < 0.1 or a < 0.05)
summary(potassium_amb_fec_no_atresia_lm)

potassium_amb_fec_no_atresia_lm_res_plot <- simulateResiduals(fittedModel = potassium_amb_fec_no_atresia_lm)
plot(potassium_amb_fec_no_atresia_lm_res_plot)

# Normality test
shapiro.test(potassium_amb_fec_no_atresia_lm_res)

# scedasticity test requires a categorical variable 

```

Results: Ambient Fecundity No Atresia Sample

- **No significant** relationship detected between glucose and weight-adj fecundity 
- Evidence: lm summary, Multiple R-squared:  0.09054,	Adjusted R-squared:  -0.06104 
F-statistic: 0.5973 on 1 and 6 DF,  p-value: 0.469


Parametric Assumptions: 

- Sample size (n > 30): **Not Met**

- Normality: **close to non-parametric**
- Evidence: Shapiro-Wilk normality test (on lm model), W = 0.85806, p-value = 0.1148


- Homoscedasticity: **???**


Model For Fecundity Class (No Atresia)
```{r}
# K+
# Amb Fec No Atresia Class regression model

potassium_amb_fec_no_atresia_aov_cat <- aov(K...mmol.L. ~ Fecundity_Class, data = Amb_Fec_No_Atresia_Samples)

summary(potassium_amb_fec_no_atresia_aov_cat)

TukeyHSD(potassium_amb_fec_no_atresia_aov_cat)

# Normality Test
shapiro.test(Amb_Fec_No_Atresia_Samples$K...mmol.L.)

# Parametric variance test: 
# Bartlett's test requires a categorical variable
bartlett.test(K...mmol.L. ~ Fecundity_Class, data = Amb_Fec_No_Atresia_Samples)

# Nonparametric variance test:
# Levene's test requires a categorical variable 
#LeveneTest(K...mmol.L. ~ Fecundity_Class, data = Amb_Fec_No_Atresia_Samples)

```

Results: Ambient Fecundity No Atresia Sample

- No significant difference in sodium between fecundity classes
- Evidence: aov summary Pr(>F) = 0.829


Parametric Assumptions: Across Sample comparisons...

- Sample size (n > 30): **Not Met**

- Normality: **Met**

- Homoscedasticity: **Met**


Model For Fecundity Class (With Atresia)
```{r}
# K+
# Amb Fec Class regression model

potassium_amb_fec_aov_cat <- aov(K...mmol.L. ~ Fecundity_Class, data = Amb_Fec_Samples)

summary(potassium_amb_fec_aov_cat)

TukeyHSD(potassium_amb_fec_aov_cat)

# Normality test
shapiro.test(Amb_Fec_Samples$K...mmol.L.) 

# Parametric variance test:
# Bartlett's test requires a categorical variable
bartlett.test(K...mmol.L. ~ Fecundity_Class, data = Amb_Fec_Samples) 
# not normal

# Nonparametric variance test:
# Levene's test requires a categorical variable 
LeveneTest(K...mmol.L. ~ Fecundity_Class, data = Amb_Fec_Samples)

# Non-parametric stat test
kruskal.test(K...mmol.L. ~ Fecundity_Class, data = Amb_Fec_Samples)

DunnTest(K...mmol.L. ~ Fecundity_Class, data = Amb_Fec_Samples)
```

Results: Ambient Fecundity Sample (With Atresia)

- **No significant** difference detected in glucose between fecundity classes: Low (~1,000s), High (>50,000), and Atresia 
- Evidence: aov summary Pr(>F) = 0.466


Parametric Assumptions: Across Sample comparisons...

- Sample size (n > 30): **Not Met**

- Normality: **Not Met, non-normal distribution**
- Evidence: Shapiro-Wilk normality test, W = 0.81347, p-value = 0.001062


- Homoscedasticity: **Not met, close to unequal variance**
- Evidence: Bartlett's K-squared = 4.6368, df = 2, p-value = 0.09843

- Meets homogeneity of variance for non-parametric standards
- Evidence: Levene's Test, F value = 0.7708, Pr(>F) = 0.4773

Nonparametric stat test results:
- **No significant** difference detected in glucose between fecundity classes.
- Evidence: Kruskal-Wallis chi-squared = 1.2081, df = 2, p-value = 0.5466


# Ca+2 : Calcium

Calcium Summary Stats
```{r}
# Ca+2
# Summary stats

# Amb Fec data (with atresia IDs)
Amb_Fec_Samples %>%
  group_by(Ambient.Or.OAH, Fecundity_Class) %>%
  summarize(count = n(),
            median = round(median(Ca....mmol.L.), 3),
            mean = round(mean(Ca....mmol.L.), 3),
            sd = round(sd(Ca....mmol.L.), 3),
            cv = round(sd(Ca....mmol.L.)/mean(Ca....mmol.L.), 3)) %>%
  ungroup()

# Amb Fec No Atresia data
Amb_Fec_No_Atresia_Samples %>%
  group_by(Ambient.Or.OAH, Fecundity_Class) %>%
  summarize(count = n(),
            median = round(median(Ca....mmol.L.), 3),
            mean = round(mean(Ca....mmol.L.), 3),
            sd = round(sd(Ca....mmol.L.), 3),
            cv = round(sd(Ca....mmol.L.)/mean(Ca....mmol.L.), 3)) %>%
  ungroup()

```


Data Graphs:

```{r}
# Ca+2
# Weight adjusted scatterplot 

# Amb Fec only scatterplot: atresia ids removed
calcium_amb_fec_no_atresia_weight_adj_scatterplot <- ggplot(data = Amb_Fec_No_Atresia_Samples) + 
  geom_point(aes(x = Ca....mmol.L., y = Weight_Adjusted_Fecundity_Fecundity.Mean_Weight), colour = "black") +
  labs(title = "Calcium", x = "Calcium (mmol/L)", y = "Weight Adjusted Fecundity") +
  scale_y_continuous() + 
  theme_classic() +
  facet_wrap(~ Ambient.Or.OAH) +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        plot.title = element_text(size = 25, hjust = 0.5),
        axis.text.x = element_text(size = 20),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(calcium_amb_fec_no_atresia_weight_adj_scatterplot)

ggsave(filename = "data-images/calcium_amb_fec_no_atresia_weight_adj_scatterplot.pdf", plot = calcium_amb_fec_no_atresia_weight_adj_scatterplot, device = "pdf")

ggsave(filename = "data-images/calcium_amb_fec_no_atresia_weight_adj_scatterplot.png", plot = calcium_amb_fec_no_atresia_weight_adj_scatterplot, device = "png")

```


Calcium Boxplot (No Atresia)
```{r}
# Ca boxplot

# Amb_Fec Samples No Atresia Ids
calcium_amb_fec_no_atresia_boxplot <- ggplot(data = Amb_Fec_No_Atresia_Samples) + 
  geom_boxplot(aes(x = Fecundity_Class, y = Ca....mmol.L.)) +
  geom_point(aes(x = Fecundity_Class, y = Ca....mmol.L.), alpha = 0.5, colour = "black") +
  labs(title = "Calcium", x = "Fecundity Class", y = "Calcium (mmol/L)") +
   facet_wrap(~ Ambient.Or.OAH) +
  theme_classic() +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        title = element_text(size = 12),
        plot.title = element_text(size = 30, hjust = 0.5),
        axis.text.x = element_text(size = 9),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(calcium_amb_fec_no_atresia_boxplot)

ggsave(filename = "data-images/calcium_amb_fec_no_atresia_boxplot.pdf", plot = calcium_amb_fec_no_atresia_boxplot, device = "pdf")
ggsave(filename = "data-images/calcium_amb_fec_no_atresia_boxplot.png", plot = calcium_amb_fec_no_atresia_boxplot, device = "png")


```



Calcium Boxplot (With Atresia)
```{r}
# Ca+2 boxplot

# Amb_Fec Samples with Atresia Ids
calcium_amb_fec_boxplot <- ggplot(data = Amb_Fec_Samples) + 
  geom_boxplot(aes(x = Fecundity_Class, y = Ca....mmol.L.)) +
  geom_point(aes(x = Fecundity_Class, y = Ca....mmol.L.), alpha = 0.5, colour = "black") +
  labs(title = "Calcium", x = "Fecundity Class", y = "Calcium (mmol/L)") +
   facet_wrap(~ Ambient.Or.OAH) +
  theme_classic() +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        title = element_text(size = 12),
        plot.title = element_text(size = 30, hjust = 0.5),
        axis.text.x = element_text(size = 9),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(calcium_amb_fec_boxplot)

ggsave(filename = "data-images/calcium_amb_fec_boxplot.pdf", plot = calcium_amb_fec_boxplot, device = "pdf")
ggsave(filename = "data-images/calcium_amb_fec_boxplot.png", plot = calcium_amb_fec_boxplot, device = "png")


```


Calcium Parametric Assessment
Data Distribution
```{r}
# Ca+2
# Parametric Assumptions

# Data Distribution

# Amb Fec Samples 
# Frequency Histograms

hist(Amb_Fec_Samples$Ca....mmol.L.)

plotNormalHistogram(Amb_Fec_Samples$Ca....mmol.L.) 

# Density plot

Amb_Fec_Samples %>%
  ggplot(aes(x = Ca....mmol.L.)) +
  stat_function(fun = dnorm, args = c(mean = mean(Amb_Fec_Samples$Ca....mmol.L.), sd = sd(Amb_Fec_Samples$Ca....mmol.L.)), aes(col = "Normal Distribution"), show.legend = TRUE) +
  geom_density(aes(col = "Sample Density"), show.legend = TRUE) +
  labs(title = "Calcium Weight Adj Fecundity Sample Distribution") +
  scale_color_manual("Distribution", values = c("Normal Distribution" = "green", "Sample Density" = "black"))

# Density by brood condition
Amb_Fec_Samples %>%
ggplot(aes(x = Ca....mmol.L.)) +
  geom_density(aes(x = Ca....mmol.L., fill = Fecundity_Class), alpha = 0.5) 

ggplot(Amb_Fec_Samples, aes(x = Ca....mmol.L.)) +
  geom_density(aes(x = Ca....mmol.L.)) +
  facet_wrap(Fecundity_Class ~ Ambient.Or.OAH) 

plotNormalDensity(Amb_Fec_Samples$Ca....mmol.L.)

```


```{r}
# Ca+2

# Amb Fec No Atresia Samples 
# Frequency Histograms

hist(Amb_Fec_No_Atresia_Samples$Ca....mmol.L.)

plotNormalHistogram(Amb_Fec_No_Atresia_Samples$Ca....mmol.L.) 

# Density plot

Amb_Fec_No_Atresia_Samples %>%
  ggplot(aes(x = Ca....mmol.L.)) +
  stat_function(fun = dnorm, args = c(mean = mean(Amb_Fec_No_Atresia_Samples$Ca....mmol.L.), sd = sd(Amb_Fec_No_Atresia_Samples$Ca....mmol.L.)), aes(col = "Normal Distribution"), show.legend = TRUE) +
  geom_density(aes(col = "Sample Density"), show.legend = TRUE) +
  labs(title = "Calcium Weight Adj Fecundity Sample Distribution") +
  scale_color_manual("Distribution", values = c("Normal Distribution" = "green", "Sample Density" = "black"))

# Density by brood condition
Amb_Fec_No_Atresia_Samples %>%
ggplot(aes(x = Ca....mmol.L.)) +
  geom_density(aes(x = Ca....mmol.L., fill = Fecundity_Class), alpha = 0.5) 

ggplot(Amb_Fec_No_Atresia_Samples, aes(x = Ca....mmol.L.)) +
  geom_density(aes(x = Ca....mmol.L.)) +
  facet_wrap(Fecundity_Class ~ Ambient.Or.OAH) 

plotNormalDensity(Amb_Fec_No_Atresia_Samples$Ca....mmol.L.)
```


# Ca+2 Stat Tests

Model Design
```{r}
# Ca+2

# Amb Fec No Atresia regression model

calcium_amb_fec_no_atresia_lm <- lm(Ca....mmol.L. ~ All_Fecundity, data = Amb_Fec_No_Atresia_Samples)

calcium_amb_fec_no_atresia_lm_res <- residuals(calcium_amb_fec_no_atresia_lm)

# p-value significant if (a < 0.1 or a < 0.05)
summary(calcium_amb_fec_no_atresia_lm)

calcium_amb_fec_no_atresia_lm_res_plot <- simulateResiduals(fittedModel = calcium_amb_fec_no_atresia_lm)
plot(calcium_amb_fec_no_atresia_lm_res_plot)

# Normality test
shapiro.test(calcium_amb_fec_no_atresia_lm_res)

# scedasticity test requires a categorical variable 

```

Results: Ambient Fecundity No Atresia Sample

- **An almost significant** relationship detected between glucose and weight-adj fecundity.
- Evidence: lm summary, Multiple R-squared:  0.3387,	Adjusted R-squared:  0.2285 
F-statistic: 3.073 on 1 and 6 DF,  p-value: 0.1301


Parametric Assumptions: 

- Sample size (n > 30): **Not Met**

- Normality: **met**

- Homoscedasticity: **???**


Residuals Plot (if significant)
```{r}
# Ca+2
# ggplot with geom_smooth(aes(x=,y=)), method = "lm")

# Amb Fec only scatterplot: atresia ids removed
calcium_amb_fec_no_atresia_weight_adj_lm_scatterplot <- ggplot(data = Amb_Fec_No_Atresia_Samples) + 
  geom_point(aes(x = Ca....mmol.L., y = Weight_Adjusted_Fecundity_Fecundity.Mean_Weight), colour = "black") +
  geom_smooth(aes(x = Ca....mmol.L., y = Weight_Adjusted_Fecundity_Fecundity.Mean_Weight), method = "lm") +
  labs(title = "Calcium", x = "Calcium (mmol/L)", y = "Weight Adjusted Fecundity") +
  scale_y_continuous() + 
  theme_classic() +
  facet_wrap(~ Ambient.Or.OAH) +
  theme(panel.background = element_rect(fill = "white"),
        plot.background = element_rect(fill = "white"),
        legend.background = element_rect(fill = "white", color = "black"),
        plot.title = element_text(size = 25, hjust = 0.5),
        axis.text.x = element_text(size = 20),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20))

print(calcium_amb_fec_no_atresia_weight_adj_lm_scatterplot)

ggsave(filename = "data-images/calcium_amb_fec_no_atresia_weight_adj_lm_scatterplot.pdf", plot = calcium_amb_fec_no_atresia_weight_adj_lm_scatterplot, device = "pdf")

ggsave(filename = "data-images/calcium_amb_fec_no_atresia_weight_adj_lm_scatterplot.png", plot = calcium_amb_fec_no_atresia_weight_adj_lm_scatterplot, device = "png")

```


Model For Fecundity Class (No Atresia)
```{r}
# Ca+2
# Amb Fec No Atresia Class regression model

calcium_amb_fec_no_atresia_aov_cat <- aov(Ca....mmol.L. ~ Fecundity_Class, data = Amb_Fec_No_Atresia_Samples)

summary(calcium_amb_fec_no_atresia_aov_cat)

TukeyHSD(calcium_amb_fec_no_atresia_aov_cat)

# Normality Test
shapiro.test(Amb_Fec_No_Atresia_Samples$Ca....mmol.L.)

# Parametric variance test: 
# Bartlett's test requires a categorical variable
bartlett.test(Ca....mmol.L. ~ Fecundity_Class, data = Amb_Fec_No_Atresia_Samples)

# Nonparametric variance test:
# Levene's test requires a categorical variable 
#LeveneTest(Ca....mmol.L. ~ Fecundity_Class, data = Amb_Fec_No_Atresia_Samples)

```


Results: Ambient Fecundity No Atresia Sample

- No significant difference in sodium between fecundity classes
- Evidence: aov summary Pr(>F) = 0.222


Parametric Assumptions: Across Sample comparisons...

- Sample size (n > 30): **Not Met**

- Normality: **Met**

- Homoscedasticity: **Met**


Model For Fecundity Class (With Atresia)
```{r}
# Ca+2
# Amb Fec Class regression model

calcium_amb_fec_aov_cat <- aov(Ca....mmol.L. ~ Fecundity_Class, data = Amb_Fec_Samples)

summary(calcium_amb_fec_aov_cat)

TukeyHSD(calcium_amb_fec_aov_cat)

# Normality test
shapiro.test(Amb_Fec_Samples$Ca....mmol.L.) 

# Parametric variance test:
# Bartlett's test requires a categorical variable
bartlett.test(Ca....mmol.L. ~ Fecundity_Class, data = Amb_Fec_Samples) 
# not normal

# Nonparametric variance test:
# Levene's test requires a categorical variable 
LeveneTest(Ca....mmol.L. ~ Fecundity_Class, data = Amb_Fec_Samples)

# Non-parametric stat test
kruskal.test(Ca....mmol.L. ~ Fecundity_Class, data = Amb_Fec_Samples)

DunnTest(Ca....mmol.L. ~ Fecundity_Class, data = Amb_Fec_Samples)
```

Results: Ambient Fecundity Sample (With Atresia)

- Parametric results: Significant
- **A significant** difference detected in glucose between fecundity classes: Low (~1,000s), High (>50,000), and Atresia 
- Evidence: aov summary Pr(>F) = 0.00482 **

- Tukey HSD test shows a significant difference between groups: Atresia-High (>50,000) and Atresia-Low (~1,000s).
- Simply, calcium is different in Atresia vs post-parturition groups
- **Atresia group displays significantly lower calcium compared to High (>50,000) fecundity class (Tukey HSD, p adj = 0.0103340).**
- **Atresia group displays significantly lower calcium compared to Low (~1,000s) fecundity group (Tukey HSD, p adj = 0.0433465).**


Parametric Assumptions: Across Sample comparisons...

- Sample size (n > 30): **Not Met**

- Normality: **Met**

- Homoscedasticity: **Not met, unequal variance, nonparametric**
- Evidence: Bartlett's K-squared = 6.1296, df = 2, p-value = 0.04666

- Meets homogeneity of variance for non-parametric standards
- Evidence: Levene's Test, F value = 1.2704, Pr(>F) = 0.3047

Nonparametric stat test results: Significant
- **A significant** difference detected in glucose between fecundity classes.
- Evidence: Kruskal-Wallis chi-squared = 9.153, df = 2, p-value = 0.01029

- **Atresia group displays significantly lower calcium compared to High (>50,000) fecundity class (Denn's test, pval = 0.0216 *).**


